<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hotel AI Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; background:#0b1020; color:#e8ecff; }
    .wrap { max-width: 860px; margin: 0 auto; padding: 18px; }
    .card { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 14px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    label { font-size: 12px; opacity: .85; display:block; margin-bottom:6px; }
    input, select, button, textarea {
      border-radius: 12px; border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25); color:#e8ecff; padding: 10px 12px;
      outline: none;
    }
    input, select { min-width: 220px; }
    button { cursor:pointer; background: rgba(90,120,255,0.35); }
    button:hover { background: rgba(90,120,255,0.5); }
    .chat { height: 420px; overflow:auto; padding: 12px; background: rgba(0,0,0,0.18); border-radius: 14px; border: 1px solid rgba(255,255,255,0.10); }
    .msg { margin: 10px 0; display:flex; }
    .bubble { max-width: 78%; padding: 10px 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.12); }
    .user { justify-content:flex-end; }
    .user .bubble { background: rgba(120,255,170,0.12); }
    .assistant .bubble { background: rgba(90,120,255,0.12); }
    .meta { font-size: 12px; opacity:.8; margin-top:6px; display:flex; gap:10px; align-items:center; }
    .badge {
      font-size: 11px; padding: 4px 8px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.08);
    }
    .status { font-size: 12px; opacity:.85; }
    .footer { margin-top: 12px; display:flex; gap:10px; }
    textarea { width: 100%; resize: none; }
    .small { font-size: 12px; opacity: .75; }
    .danger { color: #ffb4b4; }
    .ok { color: #bfffd3; }
    a { color:#b9c7ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2 style="margin:6px 0 14px 0;">ğŸ¨ Hotel AI Demo UI</h2>

    <div class="card" style="margin-bottom:12px;">
      <div class="row">
        <div>
          <label>Hotel</label>
          <select id="hotelId">
            <option value="demo-hotel">demo-hotel (basic)</option>
            <option value="olympia-athens">olympia-athens (pro)</option>
          </select>
        </div>
        <div>
          <label>Hotel Key</label>
          <input id="hotelKey" placeholder="auto-filled" />
        </div>
        <div>
          <label>Session ID</label>
          <input id="sessionId" />
        </div>
        <div style="flex:1; min-width:220px;">
          <label>API Base</label>
          <input id="apiBase" />
          <div class="small">Render: https://hotel-ai-saas.onrender.com</div>
        </div>
      </div>

      <div class="row" style="margin-top:10px; align-items:center;">
        <button id="btnSummary">ğŸ“Š View Summary (7 days)</button>
        <span id="summaryStatus" class="status"></span>
      </div>

      <div id="summaryBox" class="small" style="margin-top:10px; line-height:1.35;"></div>
    </div>

    <div class="card">
      <div id="chat" class="chat"></div>

      <div class="footer">
        <textarea id="message" rows="2" placeholder="Î“ÏÎ¬ÏˆÎµ Î¼Î®Î½Ï…Î¼Î±... (Ï€.Ï‡. Î¤Î¹ ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Ï„Î¿ check-in;)"></textarea>
        <button id="btnSend" style="min-width:120px;">Send</button>
      </div>

      <div class="small" style="margin-top:8px;">
        Tip: Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ <b>check-in</b> (FAQ), Î¼ÎµÏ„Î¬ Î¼Î¹Î± â€œÎ´ÏÏƒÎºÎ¿Î»Î·â€ ÎµÏÏÏ„Î·ÏƒÎ· (OpenAI), ÎºÎ±Î¹ Î´ÎµÏ‚ Ï„Î¿ Summary.
      </div>
    </div>
  </div>

  <script>
    const DEFAULT_KEYS = {
      "demo-hotel": "demo_key_123",
      "olympia-athens": "olympia_secret_456",
    };

    const $ = (id) => document.getElementById(id);
    const chatEl = $("chat");

    function addMessage(role, text, source) {
      const wrap = document.createElement("div");
      wrap.className = "msg " + role;

      const bubble = document.createElement("div");
      bubble.className = "bubble";

      const content = document.createElement("div");
      content.textContent = text;

      const meta = document.createElement("div");
      meta.className = "meta";

      const who = document.createElement("span");
      who.textContent = role === "user" ? "You" : "Assistant";

      const badge = document.createElement("span");
      badge.className = "badge";
      badge.textContent = source ? ("source: " + source) : "";

      meta.appendChild(who);
      if (source) meta.appendChild(badge);

      bubble.appendChild(content);
      bubble.appendChild(meta);
      wrap.appendChild(bubble);

      chatEl.appendChild(wrap);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function setStatus(el, text, kind) {
      el.textContent = text || "";
      el.className = "status " + (kind || "");
    }

    function initDefaults() {
      $("apiBase").value = "https://hotel-ai-saas.onrender.com";
      $("sessionId").value = "demo-" + Math.random().toString(16).slice(2, 8);
      $("hotelKey").value = DEFAULT_KEYS[$("hotelId").value] || "";
    }

    $("hotelId").addEventListener("change", () => {
      $("hotelKey").value = DEFAULT_KEYS[$("hotelId").value] || "";
      $("summaryBox").textContent = "";
      setStatus($("summaryStatus"), "", "");
    });

    async function sendChat() {
      const apiBase = $("apiBase").value.trim().replace(/\/$/, "");
      const hotel_id = $("hotelId").value.trim();
      const hotel_key = $("hotelKey").value.trim();
      const session_id = $("sessionId").value.trim();
      const message = $("message").value;

      if (!message.trim()) return;

      addMessage("user", message.trim(), "user");
      $("message").value = "";

      try {
        setStatus($("summaryStatus"), "Sendingâ€¦", "");

        const r = await fetch(apiBase + "/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ hotel_id, hotel_key, session_id, message })
        });

        const data = await r.json().catch(() => ({}));

        if (!r.ok) {
          const errText = data.reply || data.error || ("HTTP " + r.status);
          addMessage("assistant", errText, data.source || "error");
          setStatus($("summaryStatus"), "Chat error: " + (data.source || r.status), "danger");
          return;
        }

        addMessage("assistant", data.reply || "(no reply)", data.source || "unknown");
        setStatus($("summaryStatus"), "OK", "ok");
      } catch (e) {
        addMessage("assistant", "Network error. Check API Base / Render status.", "error");
        setStatus($("summaryStatus"), "Network error", "danger");
      }
    }

    async function loadSummary() {
      const apiBase = $("apiBase").value.trim().replace(/\/$/, "");
      const hotel_id = $("hotelId").value.trim();
      const hotel_key = $("hotelKey").value.trim();

      const url = apiBase + "/api/analytics/summary?hotel_id=" + encodeURIComponent(hotel_id)
        + "&hotel_key=" + encodeURIComponent(hotel_key)
        + "&days=7";

      try {
        setStatus($("summaryStatus"), "Loading summaryâ€¦", "");
        const r = await fetch(url);
        const data = await r.json().catch(() => ({}));

        if (!r.ok) {
          $("summaryBox").innerHTML = `<span class="danger">Summary error: ${data.error || ("HTTP " + r.status)}</span>`;
          setStatus($("summaryStatus"), "Summary error", "danger");
          return;
        }

        $("summaryBox").innerHTML =
          `<div><b>Summary:</b> ${data.summary || ""}</div>` +
          `<div class="small" style="margin-top:6px;">` +
          `plan: <b>${data.plan}</b> â€¢ cap: <b>${data.ai_daily_cap}</b>/day â€¢ free: <b>${data.free_total ?? "-"}</b> â€¢ paid: <b>${data.paid_total ?? "-"}</b>` +
          `</div>`;

        setStatus($("summaryStatus"), "Summary OK", "ok");
      } catch (e) {
        $("summaryBox").innerHTML = `<span class="danger">Network error while loading summary.</span>`;
        setStatus($("summaryStatus"), "Network error", "danger");
      }
    }

    $("btnSend").addEventListener("click", sendChat);
    $("message").addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendChat();
      }
    });
    $("btnSummary").addEventListener("click", loadSummary);

    initDefaults();

    // Seed greeting
    addMessage("assistant", "Î“ÎµÎ¹Î± ÏƒÎ¿Ï…! Î•Î¯Î¼Î±Î¹ Î¿ ÏˆÎ·Ï†Î¹Î±ÎºÏŒÏ‚ receptionist Ï„Î¿Ï… Î¾ÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿Ï… ğŸ™‚ Î ÏÏ‚ Î¼Ï€Î¿ÏÏ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÏ‰;", "system");
  </script>
</body>
</html>
